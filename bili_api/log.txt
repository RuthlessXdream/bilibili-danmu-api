INFO:     Will watch for changes in these directories: ['/home/ubuntu/research/bilibili_rec/bili_api']
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [2751372] using StatReload
2025-06-12 15:52:27,317 - asyncio - DEBUG - Using selector: EpollSelector
INFO:     Started server process [2751438]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
2025-06-12 15:52:29,518 - app.services.room_manager - INFO - Connected to room 31025025
INFO:     127.0.0.1:40708 - "POST /api/v1/rooms/31025025/connect HTTP/1.1" 200 OK
2025-06-12 15:52:30,756 - blivedm - WARNING - room=31025025 _init_host_server() failed, message=-352
2025-06-12 15:52:30,757 - blivedm - WARNING - room=31025025 init_room() failed, using default settings
2025-06-12 15:52:32,020 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=1, total_retry_count=1
2025-06-12 15:52:33,924 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=2, total_retry_count=2
INFO:     127.0.0.1:60114 - "GET /api/v1/rooms HTTP/1.1" 200 OK
2025-06-12 15:52:35,763 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=3, total_retry_count=3
2025-06-12 15:52:37,403 - blivedm - WARNING - room=31025025 _init_host_server() failed, message=-352
2025-06-12 15:52:37,403 - blivedm - WARNING - room=31025025 init_room() failed, using default settings
2025-06-12 15:52:38,274 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=4, total_retry_count=4
2025-06-12 15:52:40,198 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=5, total_retry_count=5
2025-06-12 15:52:42,227 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=6, total_retry_count=6
2025-06-12 15:52:43,853 - blivedm - WARNING - room=31025025 _init_host_server() failed, message=-352
2025-06-12 15:52:43,853 - blivedm - WARNING - room=31025025 init_room() failed, using default settings
INFO:     127.0.0.1:53700 - "GET /api/v1/rooms/31025025 HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ubuntu/research/bilibili_rec/bili_api/app/api/endpoints.py", line 25, in get_room_info
    return await live_service.get_room_info(room_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ubuntu/research/bilibili_rec/bili_api/app/services/live_service.py", line 41, in get_room_info
    return LiveService._create_room_info_response(room_info)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ubuntu/research/bilibili_rec/bili_api/app/services/live_service.py", line 156, in _create_room_info_response
    live_start_time=datetime.fromtimestamp(room_info.get("live_time", 0)) if room_info.get("live_time") else None,
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: 'str' object cannot be interpreted as an integer
2025-06-12 15:52:44,900 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=7, total_retry_count=7
2025-06-12 15:52:46,911 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=8, total_retry_count=8
2025-06-12 15:52:48,788 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=9, total_retry_count=9
2025-06-12 15:52:50,430 - blivedm - WARNING - room=31025025 _init_host_server() failed, message=-352
2025-06-12 15:52:50,430 - blivedm - WARNING - room=31025025 init_room() failed, using default settings
2025-06-12 15:52:51,631 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=10, total_retry_count=10
2025-06-12 15:52:53,498 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=11, total_retry_count=11
2025-06-12 15:52:55,399 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=12, total_retry_count=12
2025-06-12 15:52:57,038 - blivedm - WARNING - room=31025025 _init_host_server() failed, message=-352
2025-06-12 15:52:57,039 - blivedm - WARNING - room=31025025 init_room() failed, using default settings
2025-06-12 15:52:57,917 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=13, total_retry_count=13
2025-06-12 15:52:59,872 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=14, total_retry_count=14
2025-06-12 15:53:01,749 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=15, total_retry_count=15
2025-06-12 15:53:03,425 - blivedm - WARNING - room=31025025 _init_host_server() failed, message=-352
2025-06-12 15:53:03,425 - blivedm - WARNING - room=31025025 init_room() failed, using default settings
2025-06-12 15:53:04,324 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=16, total_retry_count=16
2025-06-12 15:53:06,277 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=17, total_retry_count=17
2025-06-12 15:53:08,457 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=18, total_retry_count=18
2025-06-12 15:53:10,086 - blivedm - WARNING - room=31025025 _init_host_server() failed, message=-352
2025-06-12 15:53:10,086 - blivedm - WARNING - room=31025025 init_room() failed, using default settings
2025-06-12 15:53:10,978 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=19, total_retry_count=19
2025-06-12 15:53:12,920 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=20, total_retry_count=20
2025-06-12 15:53:14,834 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=21, total_retry_count=21
2025-06-12 15:53:16,474 - blivedm - WARNING - room=31025025 _init_host_server() failed, message=-352
2025-06-12 15:53:16,474 - blivedm - WARNING - room=31025025 init_room() failed, using default settings
2025-06-12 15:53:17,355 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=22, total_retry_count=22
2025-06-12 15:53:19,253 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=23, total_retry_count=23
2025-06-12 15:53:21,222 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=24, total_retry_count=24
2025-06-12 15:53:22,862 - blivedm - WARNING - room=31025025 _init_host_server() failed, message=-352
2025-06-12 15:53:22,863 - blivedm - WARNING - room=31025025 init_room() failed, using default settings
2025-06-12 15:53:23,817 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=25, total_retry_count=25
2025-06-12 15:53:25,713 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=26, total_retry_count=26
2025-06-12 15:53:27,663 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=27, total_retry_count=27
2025-06-12 15:53:29,301 - blivedm - WARNING - room=31025025 _init_host_server() failed, message=-352
2025-06-12 15:53:29,301 - blivedm - WARNING - room=31025025 init_room() failed, using default settings
2025-06-12 15:53:30,180 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=28, total_retry_count=28
2025-06-12 15:53:32,221 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=29, total_retry_count=29
2025-06-12 15:53:34,199 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=30, total_retry_count=30
2025-06-12 15:53:35,825 - blivedm - WARNING - room=31025025 _init_host_server() failed, message=-352
2025-06-12 15:53:35,825 - blivedm - WARNING - room=31025025 init_room() failed, using default settings
2025-06-12 15:53:36,701 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=31, total_retry_count=31
2025-06-12 15:53:38,584 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=32, total_retry_count=32
2025-06-12 15:53:40,744 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=33, total_retry_count=33
2025-06-12 15:53:42,423 - blivedm - WARNING - room=31025025 _init_host_server() failed, message=-352
2025-06-12 15:53:42,423 - blivedm - WARNING - room=31025025 init_room() failed, using default settings
2025-06-12 15:53:43,320 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=34, total_retry_count=34
2025-06-12 15:53:45,197 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=35, total_retry_count=35
2025-06-12 15:53:47,262 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=36, total_retry_count=36
2025-06-12 15:53:48,904 - blivedm - WARNING - room=31025025 _init_host_server() failed, message=-352
2025-06-12 15:53:48,904 - blivedm - WARNING - room=31025025 init_room() failed, using default settings
2025-06-12 15:53:49,864 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=37, total_retry_count=37
2025-06-12 15:53:51,840 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=38, total_retry_count=38
2025-06-12 15:53:53,722 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=39, total_retry_count=39
2025-06-12 15:53:55,364 - blivedm - WARNING - room=31025025 _init_host_server() failed, message=-352
2025-06-12 15:53:55,364 - blivedm - WARNING - room=31025025 init_room() failed, using default settings
2025-06-12 15:53:56,245 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=40, total_retry_count=40
2025-06-12 15:53:58,128 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=41, total_retry_count=41
2025-06-12 15:53:59,995 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=42, total_retry_count=42
2025-06-12 15:54:01,634 - blivedm - WARNING - room=31025025 _init_host_server() failed, message=-352
2025-06-12 15:54:01,634 - blivedm - WARNING - room=31025025 init_room() failed, using default settings
2025-06-12 15:54:02,514 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=43, total_retry_count=43
2025-06-12 15:54:04,479 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=44, total_retry_count=44
2025-06-12 15:54:07,105 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=45, total_retry_count=45
2025-06-12 15:54:08,746 - blivedm - WARNING - room=31025025 _init_host_server() failed, message=-352
2025-06-12 15:54:08,747 - blivedm - WARNING - room=31025025 init_room() failed, using default settings
2025-06-12 15:54:09,709 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=46, total_retry_count=46
2025-06-12 15:54:11,599 - blivedm - WARNING - room=31025025 is reconnecting, retry_count=47, total_retry_count=47
WARNING:  StatReload detected changes in 'test_room.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [2751438]
Traceback (most recent call last):
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 131, in _main
    prepare(preparation_data)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 244, in prepare
    _fixup_main_from_name(data['init_main_from_name'])
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 268, in _fixup_main_from_name
    main_content = runpy.run_module(mod_name,
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen runpy>", line 226, in run_module
  File "<frozen runpy>", line 98, in _run_module_code
  File "<frozen runpy>", line 88, in _run_code
  File "/home/ubuntu/research/bilibili_rec/bili_api/app/main.py", line 6, in <module>
    from .core.config import settings
ImportError: cannot import name 'settings' from 'app.core.config' (/home/ubuntu/research/bilibili_rec/bili_api/app/core/config.py)
WARNING:  StatReload detected changes in 'app/core/config.py'. Reloading...
Traceback (most recent call last):
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 131, in _main
    prepare(preparation_data)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 244, in prepare
    _fixup_main_from_name(data['init_main_from_name'])
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 268, in _fixup_main_from_name
    main_content = runpy.run_module(mod_name,
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen runpy>", line 226, in run_module
  File "<frozen runpy>", line 98, in _run_module_code
  File "<frozen runpy>", line 88, in _run_code
  File "/home/ubuntu/research/bilibili_rec/bili_api/app/main.py", line 6, in <module>
    from .core.config import settings
ImportError: cannot import name 'settings' from 'app.core.config' (/home/ubuntu/research/bilibili_rec/bili_api/app/core/config.py)
WARNING:  StatReload detected changes in 'app/core/config.py'. Reloading...
Traceback (most recent call last):
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 131, in _main
    prepare(preparation_data)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 244, in prepare
    _fixup_main_from_name(data['init_main_from_name'])
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 268, in _fixup_main_from_name
    main_content = runpy.run_module(mod_name,
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen runpy>", line 226, in run_module
  File "<frozen runpy>", line 98, in _run_module_code
  File "<frozen runpy>", line 88, in _run_code
  File "/home/ubuntu/research/bilibili_rec/bili_api/app/main.py", line 7, in <module>
    from .api.endpoints import router as rest_router
  File "/home/ubuntu/research/bilibili_rec/bili_api/app/api/endpoints.py", line 4, in <module>
    from ..services.live_service import live_service
  File "/home/ubuntu/research/bilibili_rec/bili_api/app/services/live_service.py", line 9, in <module>
    from .room_manager import room_manager
ModuleNotFoundError: No module named 'app.services.room_manager'
WARNING:  StatReload detected changes in 'app/services/live_service.py'. Reloading...
Traceback (most recent call last):
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 131, in _main
    prepare(preparation_data)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 244, in prepare
    _fixup_main_from_name(data['init_main_from_name'])
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 268, in _fixup_main_from_name
    main_content = runpy.run_module(mod_name,
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen runpy>", line 226, in run_module
  File "<frozen runpy>", line 98, in _run_module_code
  File "<frozen runpy>", line 88, in _run_code
  File "/home/ubuntu/research/bilibili_rec/bili_api/app/main.py", line 7, in <module>
    from .api.endpoints import router as rest_router
  File "/home/ubuntu/research/bilibili_rec/bili_api/app/api/endpoints.py", line 4, in <module>
    from ..services.live_service import live_service
  File "/home/ubuntu/research/bilibili_rec/bili_api/app/services/live_service.py", line 9, in <module>
    from .room_manager import room_manager
ModuleNotFoundError: No module named 'app.services.room_manager'
WARNING:  StatReload detected changes in 'app/services/room_manager.py'. Reloading...
2025-06-12 15:59:01,905 - asyncio - DEBUG - Using selector: EpollSelector
INFO:     Started server process [2761992]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
WARNING:  StatReload detected changes in 'app/core/config.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [2761992]
Traceback (most recent call last):
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 131, in _main
    prepare(preparation_data)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 244, in prepare
    _fixup_main_from_name(data['init_main_from_name'])
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 268, in _fixup_main_from_name
    main_content = runpy.run_module(mod_name,
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen runpy>", line 226, in run_module
  File "<frozen runpy>", line 98, in _run_module_code
  File "<frozen runpy>", line 88, in _run_code
  File "/home/ubuntu/research/bilibili_rec/bili_api/app/main.py", line 6, in <module>
    from .core.config import settings
ImportError: cannot import name 'settings' from 'app.core.config' (/home/ubuntu/research/bilibili_rec/bili_api/app/core/config.py)
WARNING:  StatReload detected changes in 'app/services/room_manager.py'. Reloading...
Traceback (most recent call last):
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 131, in _main
    prepare(preparation_data)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 244, in prepare
    _fixup_main_from_name(data['init_main_from_name'])
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 268, in _fixup_main_from_name
    main_content = runpy.run_module(mod_name,
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen runpy>", line 226, in run_module
  File "<frozen runpy>", line 98, in _run_module_code
  File "<frozen runpy>", line 88, in _run_code
  File "/home/ubuntu/research/bilibili_rec/bili_api/app/main.py", line 6, in <module>
    from .core.config import settings
ModuleNotFoundError: No module named 'app.core.config'
WARNING:  StatReload detected changes in 'app/schemas/room.py'. Reloading...
Traceback (most recent call last):
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 131, in _main
    prepare(preparation_data)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 244, in prepare
    _fixup_main_from_name(data['init_main_from_name'])
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 268, in _fixup_main_from_name
    main_content = runpy.run_module(mod_name,
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen runpy>", line 226, in run_module
  File "<frozen runpy>", line 98, in _run_module_code
  File "<frozen runpy>", line 88, in _run_code
  File "/home/ubuntu/research/bilibili_rec/bili_api/app/main.py", line 6, in <module>
    from .core.config import settings
ModuleNotFoundError: No module named 'app.core.config'
WARNING:  StatReload detected changes in 'app/core/config.py'. Reloading...
Traceback (most recent call last):
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 131, in _main
    prepare(preparation_data)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 244, in prepare
    _fixup_main_from_name(data['init_main_from_name'])
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 268, in _fixup_main_from_name
    main_content = runpy.run_module(mod_name,
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen runpy>", line 226, in run_module
  File "<frozen runpy>", line 98, in _run_module_code
  File "<frozen runpy>", line 88, in _run_code
  File "/home/ubuntu/research/bilibili_rec/bili_api/app/main.py", line 7, in <module>
    from .api.endpoints import router as rest_router
  File "/home/ubuntu/research/bilibili_rec/bili_api/app/api/endpoints.py", line 4, in <module>
    from ..services.live_service import live_service
  File "/home/ubuntu/research/bilibili_rec/bili_api/app/services/live_service.py", line 9, in <module>
    from .room_manager import room_manager
ModuleNotFoundError: No module named 'app.services.room_manager'
WARNING:  StatReload detected changes in 'app/services/room_manager.py'. Reloading...
2025-06-12 16:05:31,438 - asyncio - DEBUG - Using selector: EpollSelector
INFO:     Started server process [2769480]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
2025-06-12 16:05:45,818 - app.services.room_manager - INFO - Connected to room 31025025
INFO:     127.0.0.1:55674 - "POST /api/v1/rooms/31025025/connect HTTP/1.1" 200 OK
2025-06-12 16:05:47,115 - blivedm - WARNING - room=31025025 _init_host_server() failed, message=-352
2025-06-12 16:05:47,115 - blivedm - ERROR - room=31025025 _network_coroutine() finished with exception:
Traceback (most recent call last):
  File "/home/ubuntu/research/bilibili_rec/blivedm/blivedm/clients/ws_base.py", line 243, in _network_coroutine_wrapper
    await self._network_coroutine()
  File "/home/ubuntu/research/bilibili_rec/blivedm/blivedm/clients/ws_base.py", line 266, in _network_coroutine
    await self._on_before_ws_connect(retry_count)
  File "/home/ubuntu/research/bilibili_rec/blivedm/blivedm/clients/web.py", line 242, in _on_before_ws_connect
    await super()._on_before_ws_connect(retry_count)
  File "/home/ubuntu/research/bilibili_rec/blivedm/blivedm/clients/ws_base.py", line 312, in _on_before_ws_connect
    raise InitError('init_room() failed')
blivedm.clients.ws_base.InitError: init_room() failed
2025-06-12 16:05:47,116 - blivedm - DEBUG - room=31025025 _network_coroutine() finished
INFO:     127.0.0.1:34658 - "GET /api/v1/rooms/31025025 HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ubuntu/research/bilibili_rec/bili_api/app/api/endpoints.py", line 25, in get_room_info
    return await live_service.get_room_info(room_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ubuntu/research/bilibili_rec/bili_api/app/services/live_service.py", line 41, in get_room_info
    return LiveService._create_room_info_response(room_info)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ubuntu/research/bilibili_rec/bili_api/app/services/live_service.py", line 156, in _create_room_info_response
    live_start_time=datetime.fromtimestamp(room_info.get("live_time", 0)) if room_info.get("live_time") else None,
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: 'str' object cannot be interpreted as an integer
INFO:     127.0.0.1:42776 - "GET /api/v1/rooms/31025025 HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ubuntu/research/bilibili_rec/bili_api/venv/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ubuntu/research/bilibili_rec/bili_api/app/api/endpoints.py", line 25, in get_room_info
    return await live_service.get_room_info(room_id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ubuntu/research/bilibili_rec/bili_api/app/services/live_service.py", line 29, in get_room_info
    return LiveService._create_room_info_response(room.room_info)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ubuntu/research/bilibili_rec/bili_api/app/services/live_service.py", line 156, in _create_room_info_response
    live_start_time=datetime.fromtimestamp(room_info.get("live_time", 0)) if room_info.get("live_time") else None,
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: 'str' object cannot be interpreted as an integer
INFO:     127.0.0.1:37362 - "GET / HTTP/1.1" 200 OK
INFO:     127.0.0.1:47060 - "GET /api/v1/rooms HTTP/1.1" 200 OK
WARNING:  StatReload detected changes in 'test_monitor.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [2769480]
2025-06-12 16:07:13,918 - asyncio - DEBUG - Using selector: EpollSelector
INFO:     Started server process [2771867]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
DEBUG:    = connection is CONNECTING
DEBUG:    < GET /api/v1/ws/rooms/31025025 HTTP/1.1
DEBUG:    < host: 127.0.0.1:8000
DEBUG:    < upgrade: websocket
DEBUG:    < connection: Upgrade
DEBUG:    < sec-websocket-key: tO/pObdnnsT12ykvHloqHw==
DEBUG:    < sec-websocket-version: 13
DEBUG:    < sec-websocket-extensions: permessage-deflate; client_max_window_bits
DEBUG:    < user-agent: Python/3.12 websockets/15.0.1
INFO:     127.0.0.1:43760 - "WebSocket /api/v1/ws/rooms/31025025" [accepted]
2025-06-12 16:08:05,483 - app.services.room_manager - INFO - Connected to room 31025025
2025-06-12 16:08:05,483 - app.services.room_manager - INFO - WebSocket client registered for room 31025025, total clients: 1
DEBUG:    > HTTP/1.1 101 Switching Protocols
DEBUG:    > Upgrade: websocket
DEBUG:    > Connection: Upgrade
DEBUG:    > Sec-WebSocket-Accept: iZ9aXMPoywG+SXQuR+aK69wyHqA=
DEBUG:    > Sec-WebSocket-Extensions: permessage-deflate
DEBUG:    > date: Thu, 12 Jun 2025 16:08:05 GMT
DEBUG:    > server: uvicorn
INFO:     connection open
DEBUG:    = connection is OPEN
DEBUG:    > TEXT '{"event":"connected","data":{"room_id":31025025...ted to room 31025025"}}' [149 bytes]
2025-06-12 16:08:06,719 - blivedm - WARNING - room=31025025 _init_host_server() failed, message=-352
2025-06-12 16:08:06,719 - blivedm - ERROR - room=31025025 _network_coroutine() finished with exception:
Traceback (most recent call last):
  File "/home/ubuntu/research/bilibili_rec/blivedm/blivedm/clients/ws_base.py", line 243, in _network_coroutine_wrapper
    await self._network_coroutine()
  File "/home/ubuntu/research/bilibili_rec/blivedm/blivedm/clients/ws_base.py", line 266, in _network_coroutine
    await self._on_before_ws_connect(retry_count)
  File "/home/ubuntu/research/bilibili_rec/blivedm/blivedm/clients/web.py", line 242, in _on_before_ws_connect
    await super()._on_before_ws_connect(retry_count)
  File "/home/ubuntu/research/bilibili_rec/blivedm/blivedm/clients/ws_base.py", line 312, in _on_before_ws_connect
    raise InitError('init_room() failed')
blivedm.clients.ws_base.InitError: init_room() failed
2025-06-12 16:08:06,720 - blivedm - DEBUG - room=31025025 _network_coroutine() finished
DEBUG:    % sending keepalive ping
DEBUG:    > PING c3 15 18 95 [binary, 4 bytes]
DEBUG:    < PONG c3 15 18 95 [binary, 4 bytes]
DEBUG:    % received keepalive pong
DEBUG:    < PING 66 01 d9 79 [binary, 4 bytes]
DEBUG:    > PONG 66 01 d9 79 [binary, 4 bytes]
DEBUG:    % sending keepalive ping
DEBUG:    > PING b1 d2 eb 7d [binary, 4 bytes]
DEBUG:    < PONG b1 d2 eb 7d [binary, 4 bytes]
DEBUG:    % received keepalive pong
DEBUG:    < PING 82 7a e1 17 [binary, 4 bytes]
DEBUG:    > PONG 82 7a e1 17 [binary, 4 bytes]
WARNING:  StatReload detected changes in 'test_room.py'. Reloading...
INFO:     Shutting down
DEBUG:    ! failing connection with code 1012
DEBUG:    = connection is CLOSING
DEBUG:    > CLOSE 1012 (service restart) [2 bytes]
DEBUG:    = connection is CLOSED
DEBUG:    x half-closing TCP connection
2025-06-12 16:08:50,116 - app.services.live_service - INFO - WebSocket client disconnected from room 31025025
2025-06-12 16:08:50,116 - app.services.room_manager - INFO - WebSocket client unregistered for room 31025025, total clients: 0
INFO:     connection closed
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [2771867]
2025-06-12 16:08:50,678 - asyncio - DEBUG - Using selector: EpollSelector
INFO:     Started server process [2773906]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
WARNING:  StatReload detected changes in 'app/services/room_manager.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [2773906]
Traceback (most recent call last):
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 131, in _main
    prepare(preparation_data)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 244, in prepare
    _fixup_main_from_name(data['init_main_from_name'])
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 268, in _fixup_main_from_name
    main_content = runpy.run_module(mod_name,
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen runpy>", line 226, in run_module
  File "<frozen runpy>", line 98, in _run_module_code
  File "<frozen runpy>", line 88, in _run_code
  File "/home/ubuntu/research/bilibili_rec/bili_api/app/main.py", line 7, in <module>
    from .api.endpoints import router as rest_router
  File "/home/ubuntu/research/bilibili_rec/bili_api/app/api/endpoints.py", line 4, in <module>
    from ..services.live_service import live_service
  File "/home/ubuntu/research/bilibili_rec/bili_api/app/services/live_service.py", line 9, in <module>
    from .room_manager import room_manager
  File "/home/ubuntu/research/bilibili_rec/bili_api/app/services/room_manager.py", line 63, in <module>
    patch_blivedm()
  File "/home/ubuntu/research/bilibili_rec/bili_api/app/services/room_manager.py", line 40, in patch_blivedm
    original_on_before_ws_connect = blivedm.clients.ws_base.WebSocketClientBase._on_before_ws_connect
                                    ^^^^^^^^^^^^^^^
AttributeError: module 'blivedm' has no attribute 'clients'
INFO:     Stopping reloader process [2751372]
